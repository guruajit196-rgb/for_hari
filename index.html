<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy Hari</title>

<style>
    body {
        margin: 0;
        background: #70c5ce;
        overflow: hidden;
        text-align: center;
    }

    canvas {
        display: block;
        margin: auto;
        background: #70c5ce;
        touch-action: none; /* REQUIRED for mobile */
    }
</style>
</head>

<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ---------- Assets ---------- */
const birdImg = new Image();
birdImg.src = "hari.jpeg";     // BIRD

const pipeImg = new Image();
pipeImg.src = "anu.jpeg";      // PILLARS

const jumpSound = new Audio("p.mp3");
const loseSound = new Audio("p1.mp3");

/* ---------- Game State ---------- */
let bird, pipes, frame, gameOver;

/* ---------- Init / Reset ---------- */
function init() {
    bird = {
        x: 80,
        y: 200,
        width: 40,
        height: 40,
        gravity: 0.5,
        lift: -8,
        velocity: 0
    };

    pipes = [];
    frame = 0;
    gameOver = false;

    draw();
}

/* ---------- Controls ---------- */

// Keyboard
document.addEventListener("keydown", () => {
    if (!gameOver) jump();
});

// Mouse (desktop)
canvas.addEventListener("mousedown", handleInput);

// Touch (mobile)
canvas.addEventListener("touchstart", handleInput, { passive: false });

function handleInput(e) {
    e.preventDefault();

    if (!gameOver) {
        jump();
    } else {
        const rect = canvas.getBoundingClientRect();
        const point = e.touches ? e.touches[0] : e;

        const x = point.clientX - rect.left;
        const y = point.clientY - rect.top;

        // Restart button bounds
        if (x > 130 && x < 270 && y > 320 && y < 360) {
            init();
        }
    }
}

function jump() {
    bird.velocity = bird.lift;
    jumpSound.currentTime = 0;
    jumpSound.play();
}

/* ---------- Pipes ---------- */
function createPipe() {
    const gap = 140;
    const topHeight = Math.random() * 250 + 50;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: topHeight + gap,
        width: 60
    });
}

/* ---------- Collision ---------- */
function hitPipe(pipe) {
    return (
        bird.x < pipe.x + pipe.width &&
        bird.x + bird.width > pipe.x &&
        (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
    );
}

/* ---------- Game Loop ---------- */
function draw() {
    if (gameOver) {
        drawGameOver();
        return;
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Bird physics
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    ctx.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);

    // Pipes
    if (frame % 90 === 0) createPipe();

    pipes.forEach(pipe => {
        pipe.x -= 2;

        ctx.drawImage(pipeImg, pipe.x, pipe.top - 400, pipe.width, 400);
        ctx.drawImage(pipeImg, pipe.x, pipe.bottom, pipe.width, 400);

        if (hitPipe(pipe)) endGame();
    });

    pipes = pipes.filter(p => p.x + p.width > 0);

    // Ground / ceiling
    if (bird.y + bird.height > canvas.height || bird.y < 0) {
        endGame();
    }

    frame++;
    requestAnimationFrame(draw);
}

/* ---------- Game Over ---------- */
function endGame() {
    if (!gameOver) {
        gameOver = true;
        loseSound.currentTime = 0;
        loseSound.play();
    }
}

function drawGameOver() {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.fillText("Game Over ðŸ˜­", 100, 260);

    // Restart button
    ctx.fillStyle = "#ffcc00";
    ctx.fillRect(130, 320, 140, 40);

    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("Restart", 165, 348);
}

/* ---------- Start Game ---------- */
init();
</script>

</body>
</html>
